/**
 * plugin.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2015 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*global tinymce:true */

tinymce.PluginManager.add('mailfield', function(editor) {

  var menuItems = [];

  editor.addButton('mailfield', {
    type   : 'splitbutton',
    icon   : 'envelope-o',
    title  : Utility.getLang('mails', 'VARIABILI_EMAILS'),
    onclick: function() {
      Utility.alert({message: Utility.getLang('mails', 'ISTRUZIONI_PLUGIN_TINYMCE'), type: 'info'});
    },
    menu   : menuItems
  });

  var chiavi = $('#chiaviDisponibili').val().split(',');

  tinymce.each(chiavi, function(chiave) {
    if(chiave.length > 0) {
      menuItems.push({
        text   : html_entity_decode(Utility.getLang('mails', chiave), 'ENT_QUOTES', 'UTF-8'),
        onclick: function() {
          editor.insertContent('{' + chiave + '}');
        }
      });
    }
  });

  editor.addMenuItem('mailfield', {
    icon   : 'date',
    text   : Utility.getLang(module_name, 'VARIABILI_EMAILS'),
    menu   : menuItems,
    context: 'insert'
  });
});